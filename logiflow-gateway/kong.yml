_format_version: "3.0"
_transform: true

services:
  # ==================== AUTH SERVICE ====================
  - name: auth-service
    url: http://host.docker.internal:8081
    tags: [authentication]
    routes:
      - name: auth-routes
        # AQUI EL CAMBIO: Agregamos /v1 si tu controller de auth también lo tiene
        paths:
          - /api/v1/auth
        # strip_path: false ES VITAL AQUÍ.
        # Significa: Kong recibe "/api/v1/auth" y le pasa "/api/v1/auth" a Spring Boot.
        # Como tu Spring Boot espera exactamente eso, funcionará perfecto.
        strip_path: false
        methods: [GET, POST, PUT, PATCH, DELETE]

  # ==================== PEDIDO SERVICE ====================
  - name: pedido-service
    url: http://host.docker.internal:8080
    tags: [pedidos]
    routes:
      - name: pedido-routes
        # AQUI EL CAMBIO: Coincide con tu @RequestMapping("/api/v1/pedidos")
        paths:
          - /api/v1/pedidos
        strip_path: false
        methods: [GET, POST, PUT, PATCH, DELETE]

  # ==================== FLEET SERVICE ====================
  - name: fleet-service
    url: http://host.docker.internal:8083
    tags: [fleet]
    routes:
      - name: fleet-routes
        paths:
          - /api/v1/fleet
        strip_path: false
        methods: [GET, POST, PUT, PATCH, DELETE]

  # ==================== BILLING SERVICE ====================
  - name: billing-service
    url: http://host.docker.internal:8084
    tags: [billing]
    routes:
      - name: billing-routes
        paths:
          - /api/v1/billing
        strip_path: false
        methods: [GET, POST, PUT, PATCH, DELETE]

# ==================== PLUGINS ====================
plugins:
  - name: cors
    config:
      origins:
        - http://localhost:3000
        - http://localhost:4200
      methods: [GET, POST, PUT, PATCH, DELETE, OPTIONS]
      headers: [Accept, Authorization, Content-Type, X-Requested-With, X-User-Id]
      exposed_headers: [Authorization, Content-Disposition]
      credentials: true
      max_age: 3600

  - name: file-log
    config:
      path: /dev/stdout
      reopen: true